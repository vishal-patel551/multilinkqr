<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MultiLinkQR – Generate Multi-Link QR Code</title>
    <meta name="description" content="Generate a QR code that opens multiple HTTPS links at once. Free multi-link QR generator with colors, labels, expiry and more.">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- QRCode library (PNG + SVG support) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }

        .brand-logo {
            font-weight: 700;
            letter-spacing: 0.03em;
        }

        .qr-preview-wrapper {
            display: inline-block;
            padding: 12px;
            border-radius: 12px;
        }

            .qr-preview-wrapper.with-border {
                border: 2px solid #dee2e6;
            }

            .qr-preview-wrapper.rounded-pixels canvas {
                border-radius: 8px;
            }

        footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            background: #ffffff;
            border-top: 1px solid #e5e5e5;
            font-size: 0.9rem;
            color: #6c757d;
        }

        .link-label-small {
            font-size: 0.8rem;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Header / Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
        <div class="container">
            <a class="navbar-brand brand-logo" href="index.html">
                <span class="text-primary">Multi</span>LinkQR
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
                    aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="generator.html">Generate QR</a></li>
                    <li class="nav-item"><a class=" nav-link" href="tips.html">QR Tips</a></li>
                    <li class="nav-item"><a class="nav-link" href="about.html">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main content -->
    <div class="container py-5">
        <div class="row g-4">
            <div class="col-lg-7">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h1 class="h3 mb-3">Generate Multi-Link QR Code</h1>
                        <p class="text-muted mb-4">
                            Create one QR code that opens multiple <strong>HTTPS</strong> links.
                            Add labels, choose design, set expiry and decide how links open.
                        </p>

                        <div id="alertArea"></div>

                        <form id="qrForm">
                            <!-- QR Name -->
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Name of QR (Title)</label>
                                <input type="text" id="qrTitle" class="form-control" placeholder="Example: Ravi's Business Links">
                                <div class="form-text">Shown on the landing page when someone scans your QR.</div>
                            </div>

                            <!-- Expiry -->
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Expiry date (optional)</label>
                                <input type="date" id="qrExpiry" class="form-control">
                                <div class="form-text">After this date, the QR will show “QR expired” instead of opening links.</div>
                            </div>

                            <!-- Mode -->
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Open mode</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="openMode" id="modeAuto" value="auto" checked>
                                    <label class="form-check-label" for="modeAuto">
                                        Auto-open all links in new tabs (plus show buttons as fallback)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="openMode" id="modeButtons" value="buttons">
                                    <label class="form-check-label" for="modeButtons">
                                        Only show buttons (user clicks each link)
                                    </label>
                                </div>
                            </div>

                            <!-- Style options -->
                            <div class="row g-3 mb-3">
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Color</label>
                                    <select id="qrColor" class="form-select">
                                        <option value="black" selected>Black</option>
                                        <option value="#0d6efd">Blue</option>
                                        <option value="#dc3545">Red</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold">Background</label>
                                    <select id="qrBg" class="form-select">
                                        <option value="#ffffff" selected>White</option>
                                        <option value="#f8f9fa">Light gray</option>
                                        <option value="#000000">Black (dark mode)</option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label fw-semibold d-block">Extras</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="qrBorder" checked>
                                        <label class="form-check-label" for="qrBorder">Show border</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="qrRounded">
                                        <label class="form-check-label" for="qrRounded">Rounded pixels (soft corners)</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Links -->
                            <div class="mb-2 d-flex justify-content-between align-items-center">
                                <label class="form-label fw-semibold mb-0">Links & Labels</label>
                                <button type="button" id="addLink" class="btn btn-outline-secondary btn-sm">
                                    + Add another link
                                </button>
                            </div>
                            <div id="linksContainer"></div>
                            <div class="form-text mb-3">
                                Each link must start with <strong>https://</strong>. Label is optional but recommended
                                (e.g., Instagram, Website, LinkedIn).
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">
                                    Generate QR Code
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- QR Output -->
            <div class="col-lg-5">
                <div class="card shadow-sm">
                    <div class="card-body p-4">
                        <h2 class="h5 mb-3">QR Preview & Download</h2>
                        <p class="text-muted mb-3">
                            After generating, you can download the QR as PNG or SVG and print or share anywhere.
                        </p>

                        <div id="noQrMessage" class="alert alert-info">
                            Generate a QR code to see preview here.
                        </div>

                        <div id="qrResult" class="d-none text-center">
                            <div id="qrTitlePreview" class="fw-semibold mb-2"></div>

                            <div id="qrWrapper" class="qr-preview-wrapper with-border" style="background-color:#ffffff;">
                                <canvas id="qrCanvas"></canvas>
                            </div>

                            <div class="mt-3">
                                <label class="form-label fw-semibold">Shareable URL</label>
                                <input type="text" id="generatedUrl" class="form-control mb-2" readonly>
                                <div class="btn-group" role="group">
                                    <button type="button" id="downloadPng" class="btn btn-outline-primary btn-sm">
                                        Download PNG
                                    </button>
                                    <button type="button" id="downloadSvg" class="btn btn-outline-secondary btn-sm">
                                        Download SVG
                                    </button>
                                </div>
                            </div>

                            <div class="mt-3 text-start">
                                <div class="link-label-small">
                                    <strong>Note:</strong> When someone scans this QR, they will be taken to the MultiLinkQR
                                    landing page which applies your expiry, style and opening mode.
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container d-flex flex-wrap justify-content-between align-items-center">
            <div>© <span id="yearSpan"></span> MultiLinkQR – Multi-link QR code generator.</div>
            <div>
                <a href="privacy-policy.html" class="me-3">Privacy Policy</a>
                <a href="terms.html">Terms</a>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const BASE_MULTI_URL = "https://yourdomain.com/multi.html"; // TODO: change to your domain

        function showAlert(message, type = "danger") {
            $("#alertArea").html(
                '<div class="alert alert-' + type + ' alert-dismissible fade show" role="alert">' +
                message +
                '<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>' +
                '</div>'
            );
        }

        function clearAlert() {
            $("#alertArea").empty();
        }

        function validateHttps(url) {
            return /^https:\/\/.+/i.test(url.trim());
        }

        function addLinkRow(url = "", label = "") {
            const idx = $("#linksContainer .link-row").length + 1;
            const row = `
            <div class="row g-2 align-items-center mb-2 link-row">
              <div class="col-12 col-md-7">
                <div class="input-group input-group-sm">
                  <span class="input-group-text">Link ${idx}</span>
                  <input type="text" class="form-control link-url" placeholder="https://example.com" value="${url}">
                </div>
              </div>
              <div class="col-9 col-md-4">
                <input type="text" class="form-control form-control-sm link-label" placeholder="Label (Instagram, Website)" value="${label}">
              </div>
              <div class="col-3 col-md-1 text-end">
                <button type="button" class="btn btn-outline-danger btn-sm remove-link" title="Remove link">&times;</button>
              </div>
            </div>
          `;
            $("#linksContainer").append(row);
            renumberLinks();
        }

        function renumberLinks() {
            $("#linksContainer .link-row").each(function (index) {
                $(this).find(".input-group-text").text("Link " + (index + 1));
            });
        }

        $(function () {
            $("#yearSpan").text(new Date().getFullYear());

            // Initial link rows
            addLinkRow("https://instagram.com/", "Instagram");
            addLinkRow("https://www.linkedin.com/", "LinkedIn");

            $("#addLink").on("click", function () {
                addLinkRow();
            });

            $("#linksContainer").on("click", ".remove-link", function () {
                $(this).closest(".link-row").remove();
                renumberLinks();
            });

            $("#qrForm").on("submit", function (e) {
                e.preventDefault();
                clearAlert();

                const title = $("#qrTitle").val().trim();
                const expiryStr = $("#qrExpiry").val();
                const color = $("#qrColor").val();
                const bg = $("#qrBg").val();
                const border = $("#qrBorder").is(":checked");
                const rounded = $("#qrRounded").is(":checked");
                const mode = $("input[name='openMode']:checked").val();

                const links = [];
                let hasError = false;

                $("#linksContainer .link-row").each(function () {
                    const url = $(this).find(".link-url").val().trim();
                    const label = $(this).find(".link-label").val().trim();
                    if (!url) return; // ignore empty rows
                    if (!validateHttps(url)) {
                        showAlert("Only links starting with <strong>https://</strong> are allowed. Invalid: " + url);
                        hasError = true;
                        return false;
                    }
                    links.push({ url: url, label: label || null });
                });

                if (hasError) return;
                if (links.length === 0) {
                    showAlert("Please enter at least one valid https link.");
                    return;
                }

                let expTimestamp = null;
                if (expiryStr) {
                    const expDate = new Date(expiryStr + "T23:59:59");
                    if (!isNaN(expDate.getTime())) {
                        expTimestamp = expDate.getTime();
                    }
                }

                const payload = {
                    title: title || null,
                    exp: expTimestamp,
                    mode: mode, // "auto" or "buttons"
                    style: {
                        color: color,
                        bg: bg,
                        border: border,
                        rounded: rounded
                    },
                    links: links
                };

                const json = JSON.stringify(payload);
                const encoded = btoa(unescape(encodeURIComponent(json)));
                const finalUrl = BASE_MULTI_URL + "?d=" + encodeURIComponent(encoded);

                // Update UI
                $("#noQrMessage").addClass("d-none");
                $("#qrResult").removeClass("d-none");
                $("#generatedUrl").val(finalUrl);
                $("#qrTitlePreview").text(title || "Your MultiLinkQR code");

                // Style wrapper
                $("#qrWrapper").css("background-color", bg);
                $("#qrWrapper").toggleClass("with-border", border);
                $("#qrWrapper").toggleClass("rounded-pixels", rounded);

                const canvas = document.getElementById("qrCanvas");
                const opts = {
                    text: finalUrl,
                    width: 220,
                    height: 220,
                    color: { dark: color, light: bg }
                };

                QRCode.toCanvas(canvas, finalUrl, {
                    width: 220,
                    margin: 2,
                    color: {
                        dark: color,
                        light: bg === "#000000" ? "#000000" : "#ffffff"
                    }
                }, function (error) {
                    if (error) {
                        console.error(error);
                        showAlert("Error generating QR code. Please try again.");
                    }
                });

                // Download PNG
                $("#downloadPng").off("click").on("click", function () {
                    const link = document.createElement("a");
                    link.download = (title || "multilinkqr") + ".png";
                    link.href = canvas.toDataURL("image/png");
                    link.click();
                });

                // Download SVG
                $("#downloadSvg").off("click").on("click", function () {
                    QRCode.toString(finalUrl, { type: "svg", margin: 2 }, function (err, svgString) {
                        if (err) {
                            console.error(err);
                            showAlert("Error generating SVG. Please try again.");
                            return;
                        }
                        const blob = new Blob([svgString], { type: "image/svg+xml;charset=utf-8" });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement("a");
                        a.href = url;
                        a.download = (title || "multilinkqr") + ".svg";
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    });
                });
            });
        });
    </script>
</body>
</html>
